#!/bin/bash

terminalize() {
	while read -r in; do
		test "$in" = "quit" && return 1
		cd "$in" || continue
		# Commit hook will take care of updating bar
		git commit -a -s --verbose
	done
	/usr/local/share/hwwm/gitbar
}

# Early exit if we have no pending commits
test $(wc -l < "$XDG_DATA_HOME/commits") -gt 0 || exit 0

dmenu -p "Repo to commit (type quit to exit): " < "$XDG_DATA_HOME/commits" | terminalize && exec $0
